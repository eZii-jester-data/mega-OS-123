{"ast":null,"code":"// https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/KMZLoader.js\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nimport { DefaultLoadingManager, FileLoader, Group, LoadingManager } from \"three\";\nimport * as JSZip from 'jszip';\nimport { ColladaLoader } from \"../loaders/ColladaLoader.js\";\n\nvar KMZLoader = function KMZLoader(manager) {\n  this.manager = manager !== undefined ? manager : DefaultLoadingManager;\n};\n\nKMZLoader.prototype = {\n  constructor: KMZLoader,\n  load: function load(url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, function (text) {\n      scope.parse(text).then(function (data) {\n        onLoad(data);\n      });\n    }, onProgress, onError);\n  },\n  setPath: function setPath(value) {\n    this.path = value;\n    return this;\n  },\n  parse: function parse(data) {\n    var promise = new Promise(function (resolve, reject) {\n      //\n      // async\n      JSZip.loadAsync(data).then(function (zip) {\n        function findFile(url) {\n          for (var path in zip.files) {\n            if (path.substr(-url.length) === url) {\n              return zip.files[path];\n            }\n          }\n        }\n\n        var manager = new LoadingManager();\n        manager.setURLModifier(function (url) {\n          var image = findFile(url);\n\n          if (image) {\n            console.log('Loading', url);\n            var blob = new Blob([image.asArrayBuffer()], {\n              type: 'application/octet-stream'\n            });\n            return URL.createObjectURL(blob);\n          }\n\n          return url;\n        });\n\n        if (zip.files['doc.kml']) {\n          zip.files['doc.kml'].async('string').then(function (content) {\n            var xml = new DOMParser().parseFromString(content, 'application/xml');\n            var model = xml.querySelector('Placemark Model Link href');\n\n            if (model) {\n              var loader = new ColladaLoader(manager);\n              zip.files[model.textContent].async('string').then(function (content) {\n                resolve(loader.parse(content));\n              });\n            }\n          });\n        } else {\n          console.warn('KMZLoader: Missing doc.kml file.');\n\n          for (var path in zip.files) {\n            var extension = path.split('.').pop().toLowerCase();\n\n            if (extension === 'dae') {\n              var loader = new ColladaLoader(manager);\n              resolve(loader.parse(zip.files[path].asText()));\n            }\n          }\n\n          console.error('KMZLoader: Couldn\\'t find .dae file.');\n          return {\n            scene: new Group()\n          };\n        }\n      }); // eslint-disable-line no-undef\n    });\n    return promise;\n  }\n};\nexport { KMZLoader };","map":{"version":3,"sources":["/Users/lemonandroid/Banal Dropbox/random/ezii-os/app/javascript/packs/kmz/jsm/loaders/KMZLoader.js"],"names":["DefaultLoadingManager","FileLoader","Group","LoadingManager","JSZip","ColladaLoader","KMZLoader","manager","undefined","prototype","constructor","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","text","parse","then","data","value","promise","Promise","resolve","reject","loadAsync","zip","findFile","files","substr","length","setURLModifier","image","console","log","blob","Blob","asArrayBuffer","type","URL","createObjectURL","async","content","xml","DOMParser","parseFromString","model","querySelector","textContent","warn","extension","split","pop","toLowerCase","asText","error","scene"],"mappings":"AAAA;;AAEA;;;AAIA,SACCA,qBADD,EAECC,UAFD,EAGCC,KAHD,EAICC,cAJD,QAKO,OALP;AAQA,OAAO,KAAKC,KAAZ,MAAuB,OAAvB;AAEA,SAASC,aAAT,QAA8B,6BAA9B;;AAEA,IAAIC,SAAS,GAAG,SAAZA,SAAY,CAAWC,OAAX,EAAqB;AAEpC,OAAKA,OAAL,GAAiBA,OAAO,KAAKC,SAAd,GAA4BD,OAA5B,GAAsCP,qBAArD;AAEA,CAJD;;AAMAM,SAAS,CAACG,SAAV,GAAsB;AAErBC,EAAAA,WAAW,EAAEJ,SAFQ;AAIrBK,EAAAA,IAAI,EAAE,cAAWC,GAAX,EAAgBC,MAAhB,EAAwBC,UAAxB,EAAoCC,OAApC,EAA8C;AAEnD,QAAIC,KAAK,GAAG,IAAZ;AAEA,QAAIC,MAAM,GAAG,IAAIhB,UAAJ,CAAgBe,KAAK,CAACT,OAAtB,CAAb;AACAU,IAAAA,MAAM,CAACC,OAAP,CAAgBF,KAAK,CAACG,IAAtB;AACAF,IAAAA,MAAM,CAACG,eAAP,CAAwB,aAAxB;AACAH,IAAAA,MAAM,CAACN,IAAP,CAAaC,GAAb,EAAkB,UAAWS,IAAX,EAAkB;AACnCL,MAAAA,KAAK,CAACM,KAAN,CAAaD,IAAb,EAAoBE,IAApB,CAAyB,UAASC,IAAT,EAAe;AACvCX,QAAAA,MAAM,CAACW,IAAD,CAAN;AACA,OAFD;AAIA,KALD,EAKGV,UALH,EAKeC,OALf;AAOA,GAlBoB;AAoBrBG,EAAAA,OAAO,EAAE,iBAAWO,KAAX,EAAmB;AAE3B,SAAKN,IAAL,GAAYM,KAAZ;AACA,WAAO,IAAP;AAEA,GAzBoB;AA2BrBH,EAAAA,KAAK,EAAE,eAAWE,IAAX,EAAkB;AACxB,QAAIE,OAAO,GAAG,IAAIC,OAAJ,CAAY,UAASC,OAAT,EAAkBC,MAAlB,EAA0B;AAEnD;AACA;AACAzB,MAAAA,KAAK,CAAC0B,SAAN,CAAiBN,IAAjB,EAAwBD,IAAxB,CAA6B,UAASQ,GAAT,EAAc;AAE1C,iBAASC,QAAT,CAAmBpB,GAAnB,EAAyB;AAIxB,eAAM,IAAIO,IAAV,IAAkBY,GAAG,CAACE,KAAtB,EAA8B;AAE7B,gBAAKd,IAAI,CAACe,MAAL,CAAa,CAAEtB,GAAG,CAACuB,MAAnB,MAAgCvB,GAArC,EAA2C;AAE1C,qBAAOmB,GAAG,CAACE,KAAJ,CAAWd,IAAX,CAAP;AAEA;AAED;AAED;;AAED,YAAIZ,OAAO,GAAG,IAAIJ,cAAJ,EAAd;AACAI,QAAAA,OAAO,CAAC6B,cAAR,CAAwB,UAAWxB,GAAX,EAAiB;AAExC,cAAIyB,KAAK,GAAGL,QAAQ,CAAEpB,GAAF,CAApB;;AAEA,cAAKyB,KAAL,EAAa;AAEZC,YAAAA,OAAO,CAACC,GAAR,CAAa,SAAb,EAAwB3B,GAAxB;AAEA,gBAAI4B,IAAI,GAAG,IAAIC,IAAJ,CAAU,CAAEJ,KAAK,CAACK,aAAN,EAAF,CAAV,EAAqC;AAAEC,cAAAA,IAAI,EAAE;AAAR,aAArC,CAAX;AACA,mBAAOC,GAAG,CAACC,eAAJ,CAAqBL,IAArB,CAAP;AAEA;;AAED,iBAAO5B,GAAP;AAEA,SAfD;;AAiBA,YAAKmB,GAAG,CAACE,KAAJ,CAAW,SAAX,CAAL,EAA8B;AAC7BF,UAAAA,GAAG,CAACE,KAAJ,CAAW,SAAX,EAAuBa,KAAvB,CAA6B,QAA7B,EAAuCvB,IAAvC,CAA4C,UAASwB,OAAT,EAAkB;AAC7D,gBAAIC,GAAG,GAAG,IAAIC,SAAJ,GAAgBC,eAAhB,CAAgCH,OAAhC,EAA0C,iBAA1C,CAAV;AAEA,gBAAII,KAAK,GAAGH,GAAG,CAACI,aAAJ,CAAmB,2BAAnB,CAAZ;;AAEA,gBAAKD,KAAL,EAAa;AAEZ,kBAAIlC,MAAM,GAAG,IAAIZ,aAAJ,CAAmBE,OAAnB,CAAb;AACAwB,cAAAA,GAAG,CAACE,KAAJ,CAAWkB,KAAK,CAACE,WAAjB,EAA+BP,KAA/B,CAAqC,QAArC,EAA+CvB,IAA/C,CAAoD,UAASwB,OAAT,EAAkB;AACrEnB,gBAAAA,OAAO,CAACX,MAAM,CAACK,KAAP,CAAayB,OAAb,CAAD,CAAP;AACA,eAFD;AAGA;AACD,WAZD;AAaA,SAdD,MAcO;AAENT,UAAAA,OAAO,CAACgB,IAAR,CAAc,kCAAd;;AAEA,eAAM,IAAInC,IAAV,IAAkBY,GAAG,CAACE,KAAtB,EAA8B;AAE7B,gBAAIsB,SAAS,GAAGpC,IAAI,CAACqC,KAAL,CAAY,GAAZ,EAAkBC,GAAlB,GAAwBC,WAAxB,EAAhB;;AAEA,gBAAKH,SAAS,KAAK,KAAnB,EAA2B;AAE1B,kBAAItC,MAAM,GAAG,IAAIZ,aAAJ,CAAmBE,OAAnB,CAAb;AACIqB,cAAAA,OAAO,CAACX,MAAM,CAACK,KAAP,CAAcS,GAAG,CAACE,KAAJ,CAAWd,IAAX,EAAkBwC,MAAlB,EAAd,CAAD,CAAP;AAEJ;AAED;;AAGDrB,UAAAA,OAAO,CAACsB,KAAR,CAAe,sCAAf;AACA,iBAAO;AAAEC,YAAAA,KAAK,EAAE,IAAI3D,KAAJ;AAAT,WAAP;AAEA;AAGD,OA1ED,EAJmD,CA8E/C;AAEJ,KAhFa,CAAd;AAmFA,WAAOwB,OAAP;AACA;AAhHoB,CAAtB;AAoHA,SAASpB,SAAT","sourcesContent":["// https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/KMZLoader.js\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport {\n\tDefaultLoadingManager,\n\tFileLoader,\n\tGroup,\n\tLoadingManager\n} from \"three\";\n\n\nimport * as JSZip from 'jszip';\n\nimport { ColladaLoader } from \"../loaders/ColladaLoader.js\";\n\nvar KMZLoader = function ( manager ) {\n\n\tthis.manager = ( manager !== undefined ) ? manager : DefaultLoadingManager;\n\n};\n\nKMZLoader.prototype = {\n\n\tconstructor: KMZLoader,\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar loader = new FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.load( url, function ( text ) {\n\t\t\tscope.parse( text ).then(function(data) {\n\t\t\t\tonLoad(data);\n\t\t\t});\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\tsetPath: function ( value ) {\n\n\t\tthis.path = value;\n\t\treturn this;\n\n\t},\n\n\tparse: function ( data ) {\t\n\t\tlet promise = new Promise(function(resolve, reject) {\n\n\t\t\t//\n\t\t\t// async\n\t\t\tJSZip.loadAsync( data ).then(function(zip) {\n\n\t\t\t\tfunction findFile( url ) {\n\t\t\t\t\n\n\n\t\t\t\t\tfor ( var path in zip.files ) {\n\t\t\n\t\t\t\t\t\tif ( path.substr( - url.length ) === url ) {\n\t\t\n\t\t\t\t\t\t\treturn zip.files[ path ];\n\t\t\n\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t}\n\n\t\t\t\tvar manager = new LoadingManager();\n\t\t\t\tmanager.setURLModifier( function ( url ) {\n\t\t\n\t\t\t\t\tvar image = findFile( url );\n\t\t\n\t\t\t\t\tif ( image ) {\n\t\t\n\t\t\t\t\t\tconsole.log( 'Loading', url );\n\t\t\n\t\t\t\t\t\tvar blob = new Blob( [ image.asArrayBuffer() ], { type: 'application/octet-stream' } );\n\t\t\t\t\t\treturn URL.createObjectURL( blob );\n\t\t\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\treturn url;\n\t\t\n\t\t\t\t} );\n\n\t\t\t\tif ( zip.files[ 'doc.kml' ] ) {\n\t\t\t\t\tzip.files[ 'doc.kml' ].async('string').then(function(content) {\n\t\t\t\t\t\tvar xml = new DOMParser().parseFromString(content , 'application/xml' );\n\n\t\t\t\t\t\tvar model = xml.querySelector( 'Placemark Model Link href' );\n\t\t\n\t\t\t\t\t\tif ( model ) {\n\t\t\n\t\t\t\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\t\t\t\tzip.files[ model.textContent ].async('string').then(function(content) {\n\t\t\t\t\t\t\t\tresolve(loader.parse(content));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'KMZLoader: Missing doc.kml file.' );\n\n\t\t\t\t\tfor ( var path in zip.files ) {\n\n\t\t\t\t\t\tvar extension = path.split( '.' ).pop().toLowerCase();\n\n\t\t\t\t\t\tif ( extension === 'dae' ) {\n\n\t\t\t\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\t\t\t\t\t\t\t\tresolve(loader.parse( zip.files[ path ].asText() ));\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t\n\n\t\t\t\t\tconsole.error( 'KMZLoader: Couldn\\'t find .dae file.' );\n\t\t\t\t\treturn { scene: new Group() };\n\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t}); // eslint-disable-line no-undef\n\t\t\t\n\t\t});\n\n\n\t\treturn promise;\n\t}\n\n};\n\nexport { KMZLoader };"]},"metadata":{},"sourceType":"module"}