{"ast":null,"code":"// https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/KMZLoader.js\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\nimport { DefaultLoadingManager, FileLoader, Group, LoadingManager } from \"three\";\nimport * as JSZip from 'jszip';\nimport { ColladaLoader } from \"../loaders/ColladaLoader.js\";\n\nvar KMZLoader = function KMZLoader(manager) {\n  this.manager = manager !== undefined ? manager : DefaultLoadingManager;\n};\n\nKMZLoader.prototype = {\n  constructor: KMZLoader,\n  load: function load(url, onLoad, onProgress, onError) {\n    var scope = this;\n    var loader = new FileLoader(scope.manager);\n    loader.setPath(scope.path);\n    loader.setResponseType('arraybuffer');\n    loader.load(url, function (text) {\n      debugger;\n      scope.parse(text).then(function (data) {\n        onLoad(data);\n      });\n    }, onProgress, onError);\n  },\n  setPath: function setPath(value) {\n    this.path = value;\n    return this;\n  },\n  parse: function parse(data) {\n    var promise = new Promise(function (resolve, reject) {\n      function findFile(url) {\n        for (var path in zip.files) {\n          if (path.substr(-url.length) === url) {\n            return zip.files[path];\n          }\n        }\n      }\n\n      var manager = new LoadingManager();\n      manager.setURLModifier(function (url) {\n        var image = findFile(url);\n\n        if (image) {\n          console.log('Loading', url);\n          var blob = new Blob([image.asArrayBuffer()], {\n            type: 'application/octet-stream'\n          });\n          return URL.createObjectURL(blob);\n        }\n\n        return url;\n      }); //\n      // async\n\n      JSZip.loadAsync(data).then(function (zip) {\n        if (zip.files['doc.kml']) {\n          var xml = new DOMParser().parseFromString(zip.files['doc.kml'].asText(), 'application/xml');\n          var model = xml.querySelector('Placemark Model Link href');\n\n          if (model) {\n            var loader = new ColladaLoader(manager);\n            promise.resolve(loader.parse(zip.files[model.textContent].asText()));\n          }\n        } else {\n          console.warn('KMZLoader: Missing doc.kml file.');\n\n          for (var path in zip.files) {\n            var extension = path.split('.').pop().toLowerCase();\n\n            if (extension === 'dae') {\n              var loader = new ColladaLoader(manager);\n              promise.resolve(loader.parse(zip.files[path].asText()));\n            }\n          }\n\n          console.error('KMZLoader: Couldn\\'t find .dae file.');\n          return {\n            scene: new Group()\n          };\n        }\n      }); // eslint-disable-line no-undef\n    });\n    return promise;\n  }\n};\nexport { KMZLoader };","map":{"version":3,"sources":["/Users/lemonandroid/Banal Dropbox/random/ezii-os/app/javascript/packs/kmz/jsm/loaders/KMZLoader.js"],"names":["DefaultLoadingManager","FileLoader","Group","LoadingManager","JSZip","ColladaLoader","KMZLoader","manager","undefined","prototype","constructor","load","url","onLoad","onProgress","onError","scope","loader","setPath","path","setResponseType","text","parse","then","data","value","promise","Promise","resolve","reject","findFile","zip","files","substr","length","setURLModifier","image","console","log","blob","Blob","asArrayBuffer","type","URL","createObjectURL","loadAsync","xml","DOMParser","parseFromString","asText","model","querySelector","textContent","warn","extension","split","pop","toLowerCase","error","scene"],"mappings":"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","sourcesContent":["// https://raw.githubusercontent.com/mrdoob/three.js/master/examples/jsm/loaders/KMZLoader.js\n\n/**\n * @author mrdoob / http://mrdoob.com/\n */\n\nimport {\n\tDefaultLoadingManager,\n\tFileLoader,\n\tGroup,\n\tLoadingManager\n} from \"three\";\n\n\nimport * as JSZip from 'jszip';\n\nimport { ColladaLoader } from \"../loaders/ColladaLoader.js\";\n\nvar KMZLoader = function ( manager ) {\n\n\tthis.manager = ( manager !== undefined ) ? manager : DefaultLoadingManager;\n\n};\n\nKMZLoader.prototype = {\n\n\tconstructor: KMZLoader,\n\n\tload: function ( url, onLoad, onProgress, onError ) {\n\n\t\tvar scope = this;\n\n\t\tvar loader = new FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.load( url, function ( text ) {\n\t\t\tdebugger;\n\t\t\tscope.parse( text ).then(function(data) {\n\t\t\t\tonLoad(data);\n\t\t\t});\n\n\t\t}, onProgress, onError );\n\n\t},\n\n\tsetPath: function ( value ) {\n\n\t\tthis.path = value;\n\t\treturn this;\n\n\t},\n\n\tparse: function ( data ) {\t\n\t\tlet promise = new Promise(function(resolve, reject) {\n\t\t\t\n\t\t\n\t\t\n\t\tfunction findFile( url ) {\n\t\t\t\n\n\n\t\t\tfor ( var path in zip.files ) {\n\n\t\t\t\tif ( path.substr( - url.length ) === url ) {\n\n\t\t\t\t\treturn zip.files[ path ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar manager = new LoadingManager();\n\t\tmanager.setURLModifier( function ( url ) {\n\n\t\t\tvar image = findFile( url );\n\n\t\t\tif ( image ) {\n\n\t\t\t\tconsole.log( 'Loading', url );\n\n\t\t\t\tvar blob = new Blob( [ image.asArrayBuffer() ], { type: 'application/octet-stream' } );\n\t\t\t\treturn URL.createObjectURL( blob );\n\n\t\t\t}\n\n\t\t\treturn url;\n\n\t\t} );\n\n\t\t//\n\t\t// async\n\t\tJSZip.loadAsync( data ).then(function(zip) {\n\n\t\t\tif ( zip.files[ 'doc.kml' ] ) {\n\n\t\t\t\tvar xml = new DOMParser().parseFromString( zip.files[ 'doc.kml' ].asText(), 'application/xml' );\n\n\t\t\t\tvar model = xml.querySelector( 'Placemark Model Link href' );\n\n\t\t\t\tif ( model ) {\n\n\t\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\t\tpromise.resolve(loader.parse( zip.files[ model.textContent ].asText() ));\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'KMZLoader: Missing doc.kml file.' );\n\n\t\t\t\tfor ( var path in zip.files ) {\n\n\t\t\t\t\tvar extension = path.split( '.' ).pop().toLowerCase();\n\n\t\t\t\t\tif ( extension === 'dae' ) {\n\n\t\t\t\t\t\tvar loader = new ColladaLoader( manager );\n\t\t\t\t\t\tpromise.resolve(loader.parse( zip.files[ path ].asText() ));\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tconsole.error( 'KMZLoader: Couldn\\'t find .dae file.' );\n\t\t\t\treturn { scene: new Group() };\n\n\t\t\t}\n\t\t\t\n\n\t\t}); // eslint-disable-line no-undef\n\t\t\n\t\t});\n\n\n\t\treturn promise;\n\t}\n\n};\n\nexport { KMZLoader };"]},"metadata":{},"sourceType":"module"}